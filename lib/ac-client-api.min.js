/*!
 * AmeriCommerce Clientside API v0.5
 * http://www.americommerce.com
 *
 * Copyright AmeriCommerce L.P.
 *
 * Date: 11/26/2012 9:36:20 AM
 */
(function(b,f){var a=b.document,e=b.JSON,c=b.AC||{};function h(){var i=Array.prototype.slice.call(arguments),k=i.shift(),j=i.shift();return function(){return k.apply(j,i.concat(Array.prototype.slice.call(arguments)))}}function g(){var l=Array.prototype.slice.call(arguments),k=l.shift(),m,j,n,o;for(m=0,j=l.length;m<j;m++){n=l[m];if(typeof n!=="function"&&Object.prototype.toString.apply(n)!=="[object Object]"){throw new TypeError()}for(o in n){k[o]=n[o]}}return k}function d(j,i,l){var m,k=function(){};if(i&&i.hasOwnProperty("constructor")){m=i.constructor}else{m=function(){j.apply(this,arguments)}}g(m,j);k.prototype=j.prototype;m.prototype=new k();if(i){g(m.prototype,i)}if(l){g(m,l)}m.prototype.constructor=m;m.__super=j.prototype;return m}c={_apiKey:null,_apiEndpoint:null,_storeDomain:null,_clientDomain:null,_protocol:"https",_ameriCartId:null,_sessionId:null,init:function(i){if(i.apiKey){c._apiKey=i.apiKey}if(i.storeDomain){c._storeDomain=i.storeDomain}if(i.cartId||i.ameriCartId){c._ameriCartId=i.cartId||i.ameriCartId}c._clientDomain=c._getCurrentDomain();c._protocol=i.protocol||c._protocol;if(c._storeDomain){c._apiEndpoint=c._protocol+"://"+c._storeDomain+"/clientapi"}c.session.init()},_getEndpoint:function(i){return c._apiEndpoint+i},_getCurrentDomain:function(){if(a){return a.domain}return"localhost"}};b.AC=c;c.base64={_keyString:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){if(!t){return f}var j="",p=0,k,o,n,m,u,s,r,q;t=this._utf8Encode(t);k=t.length;while(p<k){o=t.charCodeAt(p++);n=t.charCodeAt(p++);m=t.charCodeAt(p++);u=o>>2;s=((o&3)<<4)|(n>>4);r=((n&15)<<2)|(m>>6);q=m&63;if(isNaN(n)){r=q=64}else{if(isNaN(m)){q=64}}j+=(this._keyString.charAt(u)+this._keyString.charAt(s)+this._keyString.charAt(r)+this._keyString.charAt(q))}return j},decode:function(t){if(!t){return f}var j="",p=0,k,o,n,m,u,s,r,q;t=t.replace(/[^A-Za-z0-9\+=\/]/g,"");k=t.length;while(p<k){u=this._keyString.indexOf(t.charAt(p++));s=this._keyString.indexOf(t.charAt(p++));r=this._keyString.indexOf(t.charAt(p++));q=this._keyString.indexOf(t.charAt(p++));o=(u<<2)|(s>>4);n=((s&15)<<4)|(r>>2);m=((r&3)<<6)|q;j+=String.fromCharCode(o);if(r!=64){j+=String.fromCharCode(n)}if(q!=64){j+=String.fromCharCode(m)}}j=this._utf8Decode(j);return j},_utf8Encode:function(n){n=n.replace(/\r\n/g,"\n");var k="";for(var m=0,j=n.length;m<j;m++){var o=n.charCodeAt(m);if(o<128){k+=String.fromCharCode(o)}else{if((o>127)&&(o<2048)){k+=String.fromCharCode((o>>6)|192);k+=String.fromCharCode((o&63)|128)}else{k+=String.fromCharCode((o>>12)|224);k+=String.fromCharCode(((o>>6)&63)|128);k+=String.fromCharCode((o&63)|128)}}}return k},_utf8Decode:function(m){var j="",p=0,q=0,o=0,n=0,k=m?m.length:0;while(p<k){q=m.charCodeAt(p);if(q<128){j+=String.fromCharCode(q);p++}else{if((q>191)&&(q<224)){o=m.charCodeAt(p+1);j+=String.fromCharCode(((q&31)<<6)|(o&63));p+=2}else{o=m.charCodeAt(p+1);n=m.charCodeAt(p+2);j+=String.fromCharCode(((q&15)<<12)|((o&63)<<6)|(n&63))}}}return j}};c.queryString={encode:function(k){var n=[],j=encodeURIComponent,i,m,l;for(i in k){m=k[i];if(m!==null&&typeof m!=="undefined"){if(Object.prototype.toString.apply(m)==="[object Array]"){m=c.queryString.deflateArray(m)}l=j(i)+"="+j(m);n.push(l)}}n.sort();return n.join("&")},decode:function(r){var n=decodeURIComponent,q={},m,p,o;if(r){m=r.split("&");for(var k=0,j=m.length;k<j;k++){p=m[k].split("=",2);if(p&&p[0]){o=n(p[1]);if(o.indexOf("|")>-1){o=c.queryString.inflateArray(o)}q[n(p[0])]=o}}}return q},deflateArray:function(k){var m="";for(var l=0,j=k.length;l<j;l++){if(m.length>0){m+="|"}m+=k[l]}return m},inflateArray:function(i){return i.split("|")}};c.cookie={_defaults:{expires:-1,path:"/",secure:false},load:function(){var j="ac_"+c._apiKey,i=a.cookie.match("\\b"+j+"=([^;]*)\\b"),k;if(i){i=decodeURIComponent(i[1]);k=e.parse(c.base64.decode(i));k.expires=parseInt(k.expires,10)}return k},set:function(k){var i="ac_"+c._apiKey,j=c.merge({},c.cookie._defaults);j.domain=c._domain||a.domain;if(k){j.expires=k.expires||j.expires;j.path=k.path||j.path;j.secure=k.secure||j.secure;k.domain=j.domain}c.cookie._setRaw(i,k,j)},clear:function(){c.cookie.set(null)},_setRaw:function(k,l,i){if(!l||!i.expires){i.expires=-1}if(typeof i.expires==="number"){var m=i.expires,j=i.expires=new Date();j.setDate(j.getDate()+m)}l=l?c.base64.encode(e.stringify(l)):"";a.cookie=[encodeURIComponent(k),"=",encodeURIComponent(l),i.expires?";expires="+i.expires.toUTCString():"",i.path?";path="+i.path:"",i.domain?";domain="+i.domain:"",i.secure?";secure":""].join("")}};c.api={_callbacks:{},jsonp:function(k){if(!k){throw new Error("No options specified for the JSONP request.")}var m=c.api._generateCallbackName(),i=a.createElement("script");if(!k.method||k.method.toLowerCase()!="get"){k.method="GET"}if(!k.url){throw new Error("URL endpoint required for JSONP request.")}var l=k.data,j=k.url;l._cb="AC.api._callbacks."+m;l.z=c._sessionId;if(j.indexOf("?")>-1){j+="&"}else{j+="?"}j+=c.queryString.encode(l);if(j.length>2000){throw new Error("Data size exceeds the maximum of 2000 bytes that JSONP supports.")}c.api._callbacks[m]=function(n){k.callback&&k.callback(n);delete c.api._callbacks[m];i.parentNode.removeChild(i)};i.src=j;a.getElementsByTagName("head")[0].appendChild(i)},_generateCallbackName:function(){return"ac"+(Math.random()*(1<<30)).toString(16).replace(".","")},_handleResponse:function(i,j){c._sessionId=i.sessionId;j&&j(i)}};c.EventProvider=(function(){var i=function(){};i.prototype={subscribe:function(l,k){var j=this._getSubs();if(!j[l]){j[l]=[k]}else{j[l].push(k)}},unsubscribe:function(m,l){if(l){var k=this._getSubs()[m],j;if(!k){return}j=k.indexOf(l);if(j>-1){k.splice(j,1)}}else{delete this._getSubs()[m]}},raise:function(){var l=Array.prototype.slice.call(arguments),k=l.shift(),n=this._getSubs()[k],m,j;if(!n){return}for(m=0,j=n.length;m<j;m++){n[m].apply(this,l)}},watch:function(m,j){var k,l;if(!j()){k=this;l=function(){if(j.apply(j,arguments)){k.unsubscribe(m,l)}};this.subscribe(m,l)}},_getSubs:function(){if(!this._subscriptions){this._subscriptions={}}return this._subscriptions}};i.extend=function(j,k){var l=d(this,j,k);l.extend=this.extend;return l};return i}());c.BaseObj=(function(){return c.EventProvider.extend({setProperty:function(i,j){if(e.stringify(j)!=e.stringify(this[i])){this[i]=j;this.raise(i,j)}},bind:function(i){return h(i,this)}})}());c.Task=(function(){return c.BaseObj.extend({constructor:function(i){if(!c.Task._id){c.Task._id=1}this.uniqueName="batchTask_"+c.Task._id++;this._fn=i},run:function(){this._fn.apply(this)},done:function(i){this.setProperty("value",i)}})}());c.Batch=(function(){return c.BaseObj.extend({constructor:function(){this.reset()},add:function(j){var i;if(!(j instanceof c.Task)){i=new c.Task(j)}else{i=j}this._queue.push(i);return i},run:function(j){var i=this.bind(this._process);if(j){this.unsubscribe("complete");this.subscribe("complete",j)}if(this._timer<0){this._timer=setTimeout(i,10)}},reset:function(){this._queue=[];this._status={};this._timer=-1},_process:function(){var m=this,k=m._queue,n,j,l;this._status={};for(n=0,j=k.length;n<j;n++){l=k[n];l.subscribe("value",function(){if(this.value){m._updateStatus(this,k);this.unsubscribe("value")}});l.run()}},_updateStatus:function(i){this._status[i.uniqueName]=i;if(this._isDone()){this.raise("complete",this._status)}},_isDone:function(){var m,j,l,k=true;for(m=0,j=this._queue.length;m<j;m++){l=this._queue[m];if(!this._status[l.uniqueName]){k=false;break}}return k}},{create:function(m){var k=new c.Batch(),l,j;for(l=0,j=m.length;l<j;l++){k.add(m[l])}return k}})}());c.session={init:function(i){c.api.jsonp({data:{},url:c._getEndpoint("/session/init"),callback:function(j){c.api._handleResponse(j,i)}})}};c.cart={get:function(i){c.api.jsonp({data:{},url:c._getEndpoint("/cart"),callback:function(j){c.api._handleResponse(j,i)}})},add:function(i,j){if(c._ameriCartId){i.ameriCartId=c._ameriCartId}c.api.jsonp({data:i,url:c._getEndpoint("/cart/add"),callback:function(k){c.api._handleResponse(k,j)}})},update:function(i,j){c.api.jsonp({data:i,url:c._getEndpoint("/cart/update"),callback:function(k){c.api._handleResponse(k,j)}})},remove:function(j,i){c.api.jsonp({data:{id:j},url:c._getEndpoint("/cart/remove"),callback:function(k){c.api._handleResponse(k,i)}})},clear:function(i){c.api.jsonp({data:{},url:c._getEndpoint("/cart/clear"),callback:function(j){c.api._handleResponse(j,i)}})}};c.product={search:function(i,j){c.api.jsonp({data:i,url:c._getEndpoint("/products/search"),callback:function(k){c.api._handleResponse(k,j)}})}};c.customer={get:function(i){c.api.jsonp({data:{},url:c._getEndpoint("/customer"),callback:function(j){c.api._handleResponse(j,i)}})}}}(window));